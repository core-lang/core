//= vm-args "--gc=swiper --gc-verify"

fun main() {
  let x = Foo(1, none[Foo]());
  forceMinorCollect();
  x.next = some[Foo](Foo(2, none[Foo]()));
  x.next.value.next = some[Foo](Foo(3, none[Foo]()));
  forceMinorCollect();
  assert(x.a == 1);
  assert(x.next.value.a == 2);
  assert(x.next.value.next.value.a == 3);
}

class Foo(let a: Int, var next: Option[Foo])
